# ТЕХНИЧЕСКОЕ ЗАДАНИЕ
## Автоматизированная обработка строительных спецификаций


## 1. ОБЩИЕ СВЕДЕНИЯ

### 1.1. Наименование проекта
Система автоматизированной обработки PDF-спецификаций строительных материалов с формированием сводного отчета в формате Excel с профессиональным оформлением.

### 1.2. Основание для разработки
Необходимость автоматизации процесса обработки множественных PDF-файлов со спецификациями строительных материалов и формирования единого красиво оформленного документа Excel.

### 1.3. Назначение системы
Извлечение данных из 53 PDF-файлов со спецификациями по участкам строительства и формирование единого отчета Excel с автоматическим расчетом технических параметров и профессиональным визуальным оформлением.

---

## 2. ИСХОДНЫЕ ДАННЫЕ

### 2.1. Входные данные

**Структура исходных данных:**
- Количество PDF-файлов: **53 шт.**
- Расположение: `/pdf/`
- Формат названий: `Спека, уч. [номер].pdf`
- Особенности названий:
  - Объединенные участки: уч. 1-2, уч. 5-6, уч. 29-30, уч. 49-58
  - Пропущенный участок: уч. 44 (отсутствует)
- Кодировка: UTF-8 (кириллица)

**Структура данных в PDF:**
Каждый PDF-файл содержит таблицу со следующими столбцами:
- Наименование и техническая характеристика
- Количество
- Завод изготовитель

### 2.2. Справочные данные
- ГОСТ 18599-2001 для расчета массы ПНД труб
- Плотность материала ПЭ100: 0.96 г/см³

---

## 3. ТРЕБОВАНИЯ К ФУНКЦИОНАЛЬНОСТИ

### 3.1. Извлечение данных из PDF

**Обязательные требования:**

1. **Парсинг PDF-документов**
   - Автоматическое обнаружение таблиц в PDF
   - Распознавание заголовков столбцов
   - Извлечение данных построчно
   - Обработка кириллических символов

2. **Маппинг столбцов**
   - `Наименование и техническая характеристика` → `Номенклатура`
   - `Количество` → `Количество`
   - `Завод изготовитель` → `Завод изготовитель`
   - Имя файла → `Файл`

### 3.2. Расчет технических параметров

**Автоматический расчет массы труб:**

Формула расчета согласно ГОСТ 18599-2001:
@https://opora-ppu.ru/documentation/truby-pnd-v-ppu-gost-18599-2001.pdf?ysclid=mh0eskiegt691573373
@https://gossr.ru/page/tablica-vesov-pnd-trub?ysclid=mh0ez89sv9918137788
```
m = π × (D - e) × e × ρ / 1000

где:
m - масса 1 метра трубы (кг/м)
D - наружный диаметр трубы (мм)
e - толщина стенки трубы (мм)
ρ - плотность материала ПЭ100 (0.96 г/см³)
π - 3.14159
```

**Условия применения:**
- Расчет производится ТОЛЬКО для номенклатуры типа "Труба" и "Футляр"
- Параметры извлекаются из текста номенклатуры
- Поддерживаемые форматы:
  - `SDR формат`: "160 х9,50"
  - `∅ формат`: "∅160х23,7"

### 3.3. Формирование выходного документа

**Требования к Excel-файлу:**

1. **Структура документа**
   - Название файла: `specifications_full.xlsx`
   - Лист: "Спецификация"
   - Столбцы (по порядку):
     1. Файл
     2. Номенклатура
     3. Количество
     4. Масса
     5. Завод изготовитель

2. **Форматирование заголовка**
   - Цвет фона: синий (#4472C4)
   - Цвет текста: белый (#FFFFFF)
   - Шрифт: жирный
   - Выравнивание: по центру
   - Границы: тонкие, черные

3. **Разделители файлов (серые строки)**
   - Каждый новый PDF-файл начинается со строки-разделителя
   - Цвет фона разделителя: серый (#D3D3D3)
   - Текст: имя файла БЕЗ расширения (например: "Спека, уч. 1-2" вместо "Спека, уч. 1-2.pdf")
   - Ячейки объединены на всю ширину таблицы (5 столбцов)
   - Шрифт: жирный
   - Выравнивание: по левому краю

4. **Форматирование данных**
   - Столбец "Файл": пустой (имя файла в строке-разделителе)
   - Столбец "Номенклатура": выравнивание по левому краю, перенос текста
   - Столбец "Количество": выравнивание по центру
   - Столбец "Масса": выравнивание по центру
   - Столбец "Завод изготовитель": выравнивание по центру
   - Все ячейки: тонкие границы

5. **Настройки листа**
   - Ширина столбца "Файл": 30 символов
   - Ширина столбца "Номенклатура": 70 символов
   - Ширина столбца "Количество": 15 символов
   - Ширина столбца "Масса": 15 символов
   - Ширина столбца "Завод изготовитель": 25 символов
   - Закрепление областей: первая строка (заголовок)


## 4. ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ

### 4.1. Технологический стек

**Язык программирования:** Python 3.14+

**Обязательные библиотеки:**
- `pdfplumber 0.11.7` - парсинг PDF-документов
- `pandas 2.3.3` - обработка табличных данных
- `openpyxl 3.1.5` - создание и форматирование Excel-файлов
- `numpy 2.3.4` - математические вычисления

### 4.2. Требования к окружению

- Операционная система: macOS 24.1.0 (Darwin)
- Python: версия 3.14+
- Виртуальное окружение: venv
- Кодировка: UTF-8

### 4.3. Структура проекта

```
fedor/
├── pdf/                          # Исходные PDF-файлы (53 шт.)
├── venv/                         # Виртуальное окружение Python
├── parse_pdfs.py                 # Основной исполняемый скрипт
├── specifications_full.xlsx      # Результирующий файл
├── run.sh                        # Скрипт быстрого запуска
├── README.md                     # Документация проекта
├── TECHNICAL_SPECIFICATION.md    # Техническое задание
├── .gitignore                    # Исключения для Git
├── gradiss.csv                   # Шаблон CSV
```

---

## 5. ТРЕБОВАНИЯ К ПРОГРАММНОЙ РЕАЛИЗАЦИИ

### 5.1. Архитектура скрипта

**Модульная структура `parse_pdfs.py`:**

1. **Модуль расчета массы**
   - `calculate_pipe_mass_per_meter()` - расчет массы трубы
   - `extract_pipe_parameters()` - извлечение параметров из текста
   - `is_pipe()` - определение типа номенклатуры

2. **Модуль парсинга**
   - `parse_pdf_file()` - обработка одного PDF-файла
   - Обработка таблиц на всех страницах документа
   - Автоматическое определение столбцов по заголовкам

3. **Модуль форматирования Excel**
   - `create_excel_with_formatting()` - создание Excel с профессиональным оформлением
   - Применение стилей (цвета, шрифты, границы)
   - Создание серых строк-разделителей между файлами
   - Настройка размеров столбцов

4. **Главная функция**
   - `main()` - координация всех модулей
   - Обработка всех PDF-файлов в цикле
   - Вывод статистики обработки

### 5.2. Обработка ошибок

- Логирование процесса обработки каждого файла
- Обработка исключений при парсинге PDF
- Продолжение работы при ошибке в одном файле
- Вывод статистики: количество обработанных файлов и строк

### 5.3. Производительность

- Последовательная обработка файлов (53 файла)
- Ожидаемое время выполнения: < 2 минуты
- Размер результирующего файла: ~51 KB
- Количество обрабатываемых записей: ~1828 строк

## 7. НОМЕНКЛАТУРА ОБРАБАТЫВАЕМЫХ МАТЕРИАЛОВ

### 7.1. Типы материалов

**Трубы:**
- Труба МУЛЬТИКЛИН ЭКО RC ПЭ100 SDR17 различных диаметров (160мм, 315мм и др.)
- Футляры ПНД SDR17 различных диаметров (∅400 и др.)

**Фитинги:**
- Муфты защитные для ПЭ труб
- Отводы сварные двухсекционные (90°, 45°)
- Тройники сварные равнопроходные
- Втулки под фланец

**Фланцевые соединения:**
- Фланцы стальные накидные различных диаметров

### 7.2. Основные производители

- ПОЛИПЛАСТИК
- Другие производители (указываются в исходных PDF)

---

## 8. КРИТЕРИИ ПРИЕМКИ

### 8.1. Функциональные критерии

✅ **Выполнено:**
- [x] Все 53 PDF-файла успешно обработаны
- [x] Извлечено 1828 записей
- [x] Создан Excel-файл с профессиональным форматированием
- [x] Серые строки-разделители между файлами
- [x] Автоматический расчет массы для всех труб
- [x] Корректная обработка кириллицы

### 8.2. Технические критерии

✅ **Выполнено:**
- [x] Код структурирован и документирован
- [x] Используются указанные библиотеки
- [x] Обработка ошибок реализована
- [x] Создана документация (README.md)
- [x] Создан скрипт быстрого запуска (run.sh)

### 8.3. Качественные критерии

✅ **Выполнено:**
- [x] Excel-файл открывается без ошибок
- [x] Форматирование соответствует требованиям
- [x] Данные корректно извлечены из PDF
- [x] Массы рассчитаны по формуле ГОСТ
- [x] Производители корректно извлечены

---

## 9. РЕЗУЛЬТАТЫ ВЫПОЛНЕНИЯ

### 9.1. Статистика обработки

| Показатель | Значение |
|------------|----------|
| Обработано PDF-файлов | 53 |
| Извлечено записей | 1828 |
| Размер результирующего файла | 51 KB |
| Время выполнения | < 2 минуты |
| Ошибок обработки | 0 |

### 9.2. Созданные файлы

- ✅ `specifications_full.xlsx` - основной результат (1828 строк)
- ✅ `parse_pdfs.py` - исполняемый скрипт (327 строк)
- ✅ `run.sh` - скрипт быстрого запуска
- ✅ `README.md` - документация проекта
- ✅ `TECHNICAL_SPECIFICATION.md` - техническое задание
- ✅ `.gitignore` - конфигурация Git

### 9.3. Примеры обработанных данных

**Фрагмент результирующего Excel:**

| Файл | Номенклатура | Количество | Масса | Завод изготовитель |
|------|--------------|------------|-------|-------------------|
| **Спека, уч. 1-2** | | | | |
| | Труба МУЛЬТИКЛИН ЭКО RC ПЭ100 SDR17 - 160 х9,50 | 362.3 | 4.51 | ПОЛИПЛАСТИК |
| | Футляр ПНД SDR17 ∅400х23,7 L=48,70м | 48.7 | 28.0 | ПОЛИПЛАСТИК |
| | Муфта защитная для ПЭ трубы ∅160 | 5.0 | | |
| | Отвод сварной двухсекционный 90° ∅160 | 3.0 | | |

---

## 10. ЗАКЛЮЧЕНИЕ

### 10.1. Состояние проекта

**Статус:** ✅ **ПРОЕКТ ЗАВЕРШЕН**

Все требования технического задания выполнены в полном объеме. Система успешно обрабатывает все 53 PDF-файла, извлекает данные, рассчитывает технические параметры и формирует отчет Excel с профессиональным визуальным оформлением (синяя шапка, серые разделители, границы, оптимальная ширина столбцов)

### 10.2. Возможности для развития

**Потенциальные улучшения (опционально):**
- Автоматический расчет стоимости по прайс-листам
